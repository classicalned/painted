<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Haunted Painting – Control</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f0f0f">

<style>
  :root{
    --bg:#0f0f0f; --fg:#ddd; --muted:#9aa0a6;
    --btn:#2b2b2b; --field:#1a1a1a; --border:#333; --accent:#3a7afe;
  }
  html,body{margin:0;background:var(--bg);color:var(--fg)}
  body{
    font:20px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    display:flex; flex-direction:column; gap:18px; padding:20px; max-width:720px; margin:auto;
  }

  /* BIG buttons */
  button{
    font-size:22px; line-height:1.2;
    padding:16px 20px;
    min-height:60px; min-width:60px;
    border-radius:14px; border:0;
    background:var(--btn); color:#fff;
  }
  .reset{ background:#3b3b3b }
  .primary{ background:var(--accent) }
  .secondary{ background:#444 }

  .label{ font-weight:700; font-size:18px; color:#cfcfcf }

  /* Grids */
  .grid{ display:grid; gap:12px }
  .ranks{ grid-template-columns: repeat(4, 1fr); }   /* 13 items -> 4-4-4-1 */
  .suits{ grid-template-columns: repeat(4, 1fr); }

  /* Toggle styling + selected state */
  .toggle{ background:var(--field); border:1px solid var(--border); }
  .toggle.active{
    background:#2155ff; border-color:#2155ff;
    box-shadow: 0 0 0 3px rgba(33,85,255,0.25) inset;
  }

  /* Sizes */
  .w-large{ width:100%; padding-block:18px; font-size:24px }  /* big NEXT */
  .w-med{ width:70% }                                         /* smaller BACK */

  /* Current selection pill */
  .current{
    align-self:flex-start;
    padding:8px 12px; border-radius:999px;
    background:#1b1b1b; border:1px solid var(--border);
    font-weight:700; font-size:18px; color:#eaeaea;
  }
</style>
</head>
<body>

<!-- RESET on top -->
<button class="reset" style="width:100%" onclick="reset()">⟲ Reset</button>

<!-- Current chosen card -->
<div id="current" class="current">Card: A♥</div>

<!-- Rank buttons -->
<div class="label">Rank</div>
<div class="grid ranks" id="rankGrid"></div>

<!-- Suit buttons -->
<div class="label">Suit</div>
<div class="grid suits" id="suitGrid"></div>

<!-- Big NEXT, smaller BACK -->
<button class="primary w-large" onclick="advance()">Next ➜</button>
<button class="secondary w-med" onclick="back()">◀ Back</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyA-qhu_bH-GSKrWwAeUUmuxh5EbSrGgOrE",
  authDomain: "haunted-painting.firebaseapp.com",
  databaseURL: "https://haunted-painting-default-rtdb.firebaseio.com",
  projectId: "haunted-painting",
  storageBucket: "haunted-painting.firebasestorage.app",
  messagingSenderId: "543448897329",
  appId: "1:543448897329:web:548f8e73300484977ec210",
  measurementId: "G-4WTEQ9TRYD"
};
firebase.initializeApp(firebaseConfig);

// Fixed room
const ROOM_ID = "house01";
let ref = firebase.database().ref("rooms/"+ROOM_ID);

// state
let step = 0;
let selectedRank = "A";
let selectedSuit = "H";
let card = "AH"; // derived from selections

const currentEl = document.getElementById('current');

// helpers
function updateCurrent(){
  const suitGlyph = {H:"♥", D:"♦", C:"♣", S:"♠"}[selectedSuit];
  currentEl.textContent = `Card: ${selectedRank}${suitGlyph}`;
}
function applyCard(){
  card = selectedRank + selectedSuit; // e.g., "5S"
  ref.set({step, card});
}

// build rank buttons
const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
const rankGrid = document.getElementById('rankGrid');
ranks.forEach(r=>{
  const b = document.createElement('button');
  b.textContent = r;
  b.className = "toggle";
  b.onclick = ()=>{
    selectedRank = r;
    [...rankGrid.children].forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    updateCurrent();
    applyCard(); // auto-apply
  };
  if(r==="A") b.classList.add('active');
  rankGrid.appendChild(b);
});

// build suit buttons
const suits = [
  {v:"H", label:"♥ Hearts"},
  {v:"D", label:"♦ Diamonds"},
  {v:"C", label:"♣ Clubs"},
  {v:"S", label:"♠ Spades"},
];
const suitGrid = document.getElementById('suitGrid');
suits.forEach(s=>{
  const b = document.createElement('button');
  b.textContent = s.label;
  b.className = "toggle";
  b.onclick = ()=>{
    selectedSuit = s.v;
    [...suitGrid.children].forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    updateCurrent();
    applyCard(); // auto-apply
  };
  if(s.v==="H") b.classList.add('active');
  suitGrid.appendChild(b);
});

// navigation
function sync(){ ref.set({step, card}); }
function advance(){ step = Math.min(6, step+1); sync(); }
function back(){ step = Math.max(0, step-1); sync(); }
function reset(){ step = 0; sync(); }

// keyboard shortcuts
window.addEventListener('keydown', (e)=>{
  if(e.code==="Space"||e.key==="ArrowRight"){ advance(); }
  else if(e.key==="ArrowLeft"){ back(); }
  else if(e.key==="r"||e.key==="R"){ reset(); }
});

// init
updateCurrent();
applyCard(); // push initial "AH"
</script>
</body>
</html>
