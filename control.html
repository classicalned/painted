<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Haunted Painting – Control</title>
<style>
  body{margin:0;background:#0f0f0f;color:#ddd;font:16px system-ui;display:flex;flex-direction:column;gap:12px;padding:16px;}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  button{padding:12px 16px;border:0;border-radius:12px;background:#2b2b2b;color:#fff;font-size:16px}
  select,input{padding:10px;border-radius:10px;border:1px solid #333;background:#1a1a1a;color:#fff}
  .small{font-size:13px;color:#888}
</style>
</head>
<body>
<div class="row">
  <label>Room</label>
  <input id="room" value="house01" />
  <button onclick="setRoom()">Use</button>
</div>
<div class="row">
  <label>Card</label>
  <select id="card"></select>
  <button onclick="applyCard()">Set Card</button>
</div>
<div class="row">
  <button onclick="advance()">Next ➜</button>
  <button onclick="back()">◀ Back</button>
  <button onclick="reset()">⟲ Reset</button>
</div>
<div class="small">Steps: 0..4 = positions, 5 = final card frame.</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
/*** EDIT: same Firebase config as display.html ***/
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_APP.firebaseapp.com",
  databaseURL: "https://YOUR_APP-default-rtdb.firebaseio.com",
  projectId: "YOUR_APP",
  storageBucket: "YOUR_APP.appspot.com",
  messagingSenderId: "000000000000",
  appId: "1:000000000000:web:XXXXXXXX"
};
/*** END EDITS ***/
firebase.initializeApp(firebaseConfig);

const CARD_LIST = (()=>{ // 52-card list like "AH","2H",...,"KS"
  const ranks=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const suits=["H","D","C","S"];
  const out=[]; for(const s of suits){ for(const r of ranks){ out.push(r+s); } }
  return out;
})();

const cardSel = document.getElementById('card');
CARD_LIST.forEach(c=>{
  const o=document.createElement('option'); o.value=c; o.textContent=c; cardSel.appendChild(o);
});
cardSel.value="AH";

let ROOM_ID = "house01";
let ref = firebase.database().ref("rooms/"+ROOM_ID);
let step = 0;
let card = "AH";

function setRoom(){
  ROOM_ID = document.getElementById('room').value.trim() || "house01";
  ref = firebase.database().ref("rooms/"+ROOM_ID);
  // push current local state to make sure display gets something
  ref.set({step, card});
}

function sync(){ ref.set({step, card}); }
function advance(){ step = Math.min(5, step+1); sync(); }
function back(){ step = Math.max(0, step-1); sync(); }
function reset(){ step = 0; sync(); }
function applyCard(){ card = cardSel.value.toUpperCase(); sync(); }

// Keyboard shortcuts (Space/Right/Left/R)
window.addEventListener('keydown', (e)=>{
  if(e.code==="Space"||e.key==="ArrowRight"){ advance(); }
  else if(e.key==="ArrowLeft"){ back(); }
  else if(e.key==="r"||e.key==="R"){ reset(); }
});

setRoom(); // initialize
</script>
</body>
</html>